{"version":3,"file":"useFormInput-ChuSfLPY.js","sources":["../src/utils/debounce.ts","../src/utils/normalizeInput.ts","../src/composables/useFormInput.ts"],"sourcesContent":["import {type MaybeRefOrGetter, toValue} from 'vue'\nimport type {\n  AnyFn,\n  ArgumentsType,\n  DebounceFilterOptions,\n  EventFilter,\n  FunctionArgs,\n  UseDebounceFnReturn,\n} from '@vueuse/core'\n\nexport const noop = () => {}\n\n/**\n * @internal\n */\nfunction createFilterWrapper<T extends AnyFn>(filter: EventFilter & {cancel: () => void}, fn: T) {\n  /* eslint-disable @typescript-eslint/no-explicit-any */\n  function wrapper(this: any, ...args: ArgumentsType<T>) {\n    return new Promise<Awaited<ReturnType<T>>>((resolve, reject) => {\n      // make sure it's a promise\n      Promise.resolve(filter(() => fn.apply(this, args), {fn, thisArg: this, args}))\n        .then(resolve)\n        .catch(reject)\n    })\n  }\n\n  // https://github.com/vueuse/vueuse/pull/4561\n  wrapper.cancel = filter.cancel\n  return wrapper\n}\n\n/**\n * Create an EventFilter that debounce the events\n */\nfunction debounceFilter(ms: MaybeRefOrGetter<number>, options: DebounceFilterOptions = {}) {\n  let timer: ReturnType<typeof setTimeout> | undefined\n  let maxTimer: ReturnType<typeof setTimeout> | undefined | null\n  let lastRejector: AnyFn = noop\n\n  const _clearTimeout = (timer: ReturnType<typeof setTimeout>) => {\n    clearTimeout(timer)\n    lastRejector()\n    lastRejector = noop\n  }\n\n  let lastInvoker: () => void\n\n  const filter: EventFilter & {cancel: () => void} = (invoke) => {\n    const duration = toValue(ms)\n    const maxDuration = toValue(options.maxWait)\n\n    if (timer) _clearTimeout(timer)\n\n    if (duration <= 0 || (maxDuration !== undefined && maxDuration <= 0)) {\n      if (maxTimer) {\n        _clearTimeout(maxTimer)\n        maxTimer = null\n      }\n      return Promise.resolve(invoke())\n    }\n\n    return new Promise((resolve, reject) => {\n      lastRejector = options.rejectOnCancel ? reject : resolve\n      lastInvoker = invoke\n      // Create the maxTimer. Clears the regular timer on invoke\n      if (maxDuration && !maxTimer) {\n        maxTimer = setTimeout(() => {\n          if (timer) _clearTimeout(timer)\n          maxTimer = null\n          resolve(lastInvoker())\n        }, maxDuration)\n      }\n\n      // Create the regular timer. Clears the max timer on invoke\n      timer = setTimeout(() => {\n        if (maxTimer) _clearTimeout(maxTimer)\n        maxTimer = null\n        resolve(invoke())\n      }, duration)\n    })\n  }\n\n  // https://github.com/vueuse/vueuse/pull/4561\n  filter.cancel = () => {\n    if (timer) _clearTimeout(timer)\n    if (maxTimer) _clearTimeout(maxTimer)\n    maxTimer = null\n  }\n\n  return filter\n}\n\n/**\n * Debounce execution of a function.\n *\n * @see https://vueuse.org/useDebounceFn\n * @param  fn          A function to be executed after delay milliseconds debounced.\n * @param  ms          A zero-or-greater delay in milliseconds. For event callbacks, values around 100 or 250 (or even higher) are most useful.\n * @param  options     Options\n *\n * @return A new, debounce, function, provided with a cancel method.\n */\nexport function useDebounceFn<T extends FunctionArgs>(\n  fn: T,\n  ms: MaybeRefOrGetter<number> = 200,\n  options: DebounceFilterOptions = {}\n): UseDebounceFnReturn<T> & {cancel: () => void} {\n  return createFilterWrapper(debounceFilter(ms, options), fn)\n}\n","import type {Numberish} from '../types/CommonTypes'\n\nexport const normalizeInput = (\n  v: Numberish | null,\n  modelModifiers: Record<'number' | 'lazy' | 'trim', true | undefined>\n) => {\n  if (v === null) return\n  let update = v\n  if (modelModifiers.number && typeof update === 'string' && update !== '') {\n    const parsed = Number.parseFloat(update)\n    update = Number.isNaN(parsed) ? update : parsed\n  }\n  return update\n}\n","import type {Numberish} from '../types/CommonTypes'\nimport {\n  computed,\n  inject,\n  nextTick,\n  onActivated,\n  onMounted,\n  ref,\n  type Ref,\n  type ShallowRef,\n} from 'vue'\nimport {useAriaInvalid} from './useAriaInvalid'\nimport {useId} from './useId'\nimport {useFocus, useToNumber} from '@vueuse/core'\nimport type {CommonInputProps} from '../types/FormCommonInputProps'\nimport {formGroupPluginKey} from '../utils/keys'\nimport {useDebounceFn} from '../utils/debounce'\nimport {useStateClass} from './useStateClass'\n\nexport const useFormInput = (\n  props: Readonly<CommonInputProps>,\n  input:\n    | Readonly<ShallowRef<HTMLInputElement | null>>\n    | Readonly<ShallowRef<HTMLTextAreaElement | null>>,\n  modelValue: Ref<Numberish | null>,\n  modelModifiers: Record<'number' | 'lazy' | 'trim', true | undefined>\n) => {\n  const forceUpdateKey = ref(0)\n\n  const computedId = useId(() => props.id, 'input')\n  const debounceNumber = useToNumber(() => props.debounce ?? 0, {nanToZero: true})\n  const debounceMaxWaitNumber = useToNumber(() => props.debounceMaxWait ?? NaN)\n\n  // This automatically adds the appropriate \"for\" attribute to a BFormGroup label\n  const formGroupData = inject(formGroupPluginKey, null)?.(computedId)\n  const computedState = computed(() =>\n    props.state !== undefined ? props.state : (formGroupData?.state.value ?? null)\n  )\n  const computedAriaInvalid = useAriaInvalid(() => props.ariaInvalid, computedState)\n  const stateClass = useStateClass(computedState)\n\n  const internalUpdateModelValue = useDebounceFn(\n    (value: Numberish) => {\n      modelValue.value = value\n    },\n    () => (modelModifiers.lazy === true ? 0 : debounceNumber.value),\n    {maxWait: () => (modelModifiers.lazy === true ? NaN : debounceMaxWaitNumber.value)}\n  )\n\n  const updateModelValue = (value: Numberish, force = false, immediate = false) => {\n    if (modelModifiers.lazy === true && force === false) return\n    if (immediate) {\n      modelValue.value = value\n    } else {\n      internalUpdateModelValue(value)\n    }\n  }\n\n  const {focused} = useFocus(input, {\n    initialValue: props.autofocus,\n  })\n\n  const _formatValue = (value: string, evt: Readonly<Event>, force = false) => {\n    if (props.formatter !== undefined && (!props.lazyFormatter || force)) {\n      return props.formatter(value, evt)\n    }\n    return value\n  }\n  onMounted(() => {\n    if (input.value) {\n      input.value.value = modelValue.value?.toString() ?? ''\n    }\n  })\n\n  onActivated(() => {\n    nextTick(() => {\n      if (props.autofocus) {\n        focused.value = true\n      }\n    })\n  })\n\n  const onInput = (evt: Readonly<Event>) => {\n    const {value} = evt.target as HTMLInputElement\n    const formattedValue = _formatValue(value, evt)\n    if (evt.defaultPrevented) {\n      evt.preventDefault()\n      return\n    }\n\n    const nextModel = formattedValue\n\n    updateModelValue(nextModel)\n  }\n\n  const onChange = (evt: Readonly<Event>) => {\n    const {value} = evt.target as HTMLInputElement\n    const formattedValue = _formatValue(value, evt)\n    if (evt.defaultPrevented) {\n      evt.preventDefault()\n      return\n    }\n\n    const nextModel = formattedValue\n    if (modelValue.value !== nextModel) {\n      updateModelValue(formattedValue, true)\n    }\n  }\n\n  const onBlur = (evt: Readonly<FocusEvent>) => {\n    if (\n      !modelModifiers.lazy &&\n      !props.lazyFormatter &&\n      !modelModifiers.trim &&\n      debounceNumber.value <= 0\n    )\n      return\n\n    const {value} = evt.target as HTMLInputElement\n    const formattedValue = _formatValue(value, evt, true)\n\n    const nextModel = modelModifiers.trim ? formattedValue.trim() : formattedValue\n    const needsForceUpdate = nextModel.length !== formattedValue.length\n    // Cancel before modelValue.value comparison and update\n    internalUpdateModelValue.cancel()\n    if (modelValue.value !== nextModel) {\n      updateModelValue(formattedValue, true, true)\n    }\n    if (modelModifiers.trim && needsForceUpdate) {\n      // The value is trimmed but there would still exist some white space\n      // So, force update the value. You need to bind this to :key on the input element\n      forceUpdateKey.value = forceUpdateKey.value + 1\n    }\n  }\n\n  const focus = () => {\n    if (!props.disabled) {\n      focused.value = true\n    }\n  }\n\n  const blur = () => {\n    if (!props.disabled) {\n      focused.value = false\n    }\n  }\n\n  return {\n    input,\n    computedId,\n    computedAriaInvalid,\n    onInput,\n    onChange,\n    onBlur,\n    focus,\n    blur,\n    forceUpdateKey,\n    stateClass,\n  }\n}\n"],"names":["noop","useDebounceFn","fn","ms","options","filter","wrapper","args","Promise","resolve","reject","apply","this","thisArg","then","catch","cancel","createFilterWrapper","timer","maxTimer","lastRejector","_clearTimeout","clearTimeout","lastInvoker","invoke","duration","toValue","maxDuration","maxWait","rejectOnCancel","setTimeout","debounceFilter","v","modelModifiers","update","number","parsed","Number","parseFloat","isNaN","props","input","modelValue","forceUpdateKey","ref","computedId","useId","id","debounceNumber","useToNumber","debounce","nanToZero","debounceMaxWaitNumber","debounceMaxWait","NaN","formGroupData","inject","vue","formGroupPluginKey","_a","computedState","computed","state","value","computedAriaInvalid","useAriaInvalid","ariaInvalid","stateClass","useStateClass","internalUpdateModelValue","lazy","updateModelValue","force","immediate","focused","useFocus","initialValue","autofocus","_formatValue","evt","formatter","lazyFormatter","onMounted","toString","onActivated","nextTick","onInput","target","formattedValue","defaultPrevented","preventDefault","onChange","nextModel","onBlur","trim","needsForceUpdate","length","focus","disabled","blur"],"mappings":"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"}